<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINO Fortress</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a3a14;
            touch-action: manipulation;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        #map {
            background: #1a3a14;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1f2937;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
        }
        .menu-item {
            transition: all 0.3s ease;
            position: relative;
        }
        .menu-item:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .menu-item.active {
            color: #3b82f6;
            transform: translateY(-5px);
        }
        .tooltip {
            visibility: hidden;
            width: 200px;
            background-color: #374151;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 50;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        .fortress {
            background-color: #6b7280;
            border: 4px solid #4b5563;
            box-shadow:
                0 0 0 4px #4b5563,
                0 0 0 8px #374151,
                0 0 20px rgba(0,0,0,0.5) inset;
        }
        .tower {
            position: absolute;
            width: 24px;
            height: 36px;
            background-color: #4b5563;
            border: 2px solid #374151;
            transform: translate(-50%, -50%);
        }
        .tower::before {
            content: '';
            position: absolute;
            top: -4px;
            left: 0;
            width: 100%;
            height: 4px;
            background: repeating-linear-gradient(
                90deg,
                #374151,
                #374151 4px,
                transparent 4px,
                transparent 8px
            );
        }
        .house {
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: #78350f;
            border-radius: 2px;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        .tree {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 30px solid #0f4a1e;
            transform: translate(-50%, -50%);
            z-index: 1;
        }
        .tree-trunk {
            position: absolute;
            width: 4px;
            height: 10px;
            background-color: #5a2c0e;
            transform: translate(-50%, 10px);
            z-index: 1;
        }
        .citizen {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #f3e8ff;
            border-radius: 50%;
            animation: citizenMove 6s ease-in-out infinite;
            z-index: 10;
        }
        @keyframes citizenMove {
            0% { transform: translate(0, 0); }
            25% { transform: translate(10px, -5px); }
            50% { transform: translate(0, 0); }
            75% { transform: translate(-10px, 5px); }
            100% { transform: translate(0, 0); }
        }
        .refugee {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #f3e8ff;
            border-radius: 50%;
            animation: refugeeRun 4s linear forwards;
            z-index: 10;
        }
        .refugee::after {
            content: attr(data-text);
            position: absolute;
            top: -15px;
            left: -10px;
            font-size: 10px;
            background: rgba(0,0,0,0.7);
            padding: 0 3px;
            border-radius: 3px;
            white-space: nowrap;
        }
        @keyframes refugeeRun {
            0% { transform: translate(0, 0); }
            100% { transform: translate(var(--tx), var(--ty)); }
        }
        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: fireworkExplode 1s forwards;
            z-index: 20;
        }
        @keyframes fireworkExplode {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(10); opacity: 0; }
        }
        .smoke {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(128, 128, 128, 0.7);
            border-radius: 50%;
            animation: smokeRise 3s forwards;
            z-index: 20;
        }
        @keyframes smokeRise {
            0% { transform: translate(0, 0); opacity: 0.7; }
            100% { transform: translate(0, -50px); opacity: 0; }
        }
        .fire {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ff4500, #ff8c00, transparent 70%);
            border-radius: 50%;
            animation: fireBurn 1s infinite alternate;
            z-index: 20;
        }
        @keyframes fireBurn {
            from { transform: scale(1); opacity: 0.8; }
            to { transform: scale(1.3); opacity: 1; }
        }
        .panel {
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            background: rgba(31, 41, 55, 0.95);
            border-radius: 15px 15px 0 0;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 30;
            max-height: 60vh;
            overflow-y: auto;
        }
        .panel.active {
            transform: translateY(0);
        }
        .close-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
        }
        .gate {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 20px;
            height: 30px;
            background-color: #4b5563;
            transform: translate(-50%, 0);
            transition: height 1s ease;
            z-index: 15;
        }
        .gate.open {
            height: 0;
        }
        .fortress-wall {
            position: absolute;
            background-color: #4b5563;
            border: 2px solid #374151;
            z-index: 5;
        }
        .fortress-wall.top {
            top: 0;
            left: 20%;
            right: 20%;
            height: 10px;
        }
        .fortress-wall.bottom {
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 10px;
        }
        .fortress-wall.left {
            top: 10%;
            bottom: 10%;
            left: 0;
            width: 10px;
        }
        .fortress-wall.right {
            top: 10%;
            bottom: 10%;
            right: 0;
            width: 10px;
        }
        .battlefield {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 5;
        }
        .troop {
            width: 30px;
            height: 45px;
            position: absolute;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            z-index: 10;
            transition: all 8s ease-in-out;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        .enemy-troop {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            box-shadow: 0 0 15px #ff0000, inset 0 0 5px rgba(255,255,255,0.3);
        }
        .defender-troop {
            background: linear-gradient(135deg, #4444ff 0%, #0000cc 100%);
            box-shadow: 0 0 15px #0000ff, inset 0 0 5px rgba(255,255,255,0.3);
        }
        .troop-count {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px black;
            z-index: 11;
        }
        .swords {
            position: absolute;
            font-size: 40px;
            opacity: 0;
            transition: opacity 0.3s;
            filter: drop-shadow(0 0 5px gold);
        }
        .active-battle .swords {
            opacity: 1;
            animation: sword-clash 0.3s infinite;
        }
        @keyframes sword-clash {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(30deg); }
            75% { transform: translate(-50%, -50%) rotate(-30deg); }
            100% { transform: translate(-50%, -50%) rotate(0deg); }
        }
        .health-bar {
            width: 40px;
            height: 5px;
            background: rgba(0,0,0,0.3);
            position: absolute;
            bottom: -15px;
            border-radius: 2px;
            overflow: hidden;
        }
        .health-fill {
            height: 100%;
            width: 100%;
            background: #00ff00;
            transition: width 0.3s;
        }
        .caravan {
            position: absolute;
            width: 60px;
            height: 30px;
            background: #78350f;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            z-index: 10;
            transition: all 10s linear;
        }
        .caravan::after {
            content: '';
            position: absolute;
            width: 100px;
            height: 5px;
            background: linear-gradient(90deg, #78350f, transparent);
            right: -100px;
            top: 50%;
            transform: translateY(-50%);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .stats-card {
            background: rgba(31, 41, 55, 0.8);
            border-radius: 8px;
            padding: 10px;
        }
        .tab-content {
    display: none;
}
.tab-content.active {
    display: block;
}
#caravansTab.active, #marketTab.active {
    background-color: #4b5563;
    color: #fff;
}
    </style>
</head>
<body class="text-white min-h-screen pb-16">
    <div id="gameContainer" class="w-full h-full overflow-hidden">
        <header class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl font-bold">DINO Fortress</h1>
                <p class="text-sm text-gray-400">–î–µ–Ω—å: <span id="dayCounter">1</span></p>
            </div>
            <div class="flex gap-2">
                <div class="bg-gray-800 px-2 py-1 rounded-lg text-sm">
                    <span class="text-gray-400">üí∞:</span> <span id="fortressBalance" class="font-bold">10000</span>
                </div>
                <div class="bg-gray-800 px-2 py-1 rounded-lg text-sm">
                    <span class="text-gray-400">üçû:</span> <span id="food" class="font-bold">500</span>
                </div>
                <div class="bg-gray-800 px-2 py-1 rounded-lg text-sm">
                    <span class="text-gray-400">üë•:</span> <span id="populationDisplay" class="font-bold">1000</span>
                    <div class="text-xs text-center">
                        <span class="text-gray-400">‚öîÔ∏è:</span> <span id="troopsDisplay" class="font-bold">50</span>
                    </div>
                </div>
            </div>
        </header>

        <div id="map" class="relative rounded-lg overflow-hidden mb-4" style="height: 400px;">
            <div id="battlefield" class="battlefield hidden"></div>
            <div id="fortress" class="absolute w-40 h-40 fortress flex items-center justify-center font-bold" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
                <div class="tower" style="top: 0%; left: 0%;"></div>
                <div class="tower" style="top: 0%; left: 100%;"></div>
                <div class="tower" style="top: 100%; left: 0%;"></div>
                <div class="tower" style="top: 100%; left: 100%;"></div>
                <div class="house" style="top: 15%; left: 15%;"></div>
                <div class="house" style="top: 15%; left: 30%;"></div>
                <div class="house" style="top: 15%; left: 70%;"></div>
                <div class="house" style="top: 15%; left: 85%;"></div>
                <div class="house" style="top: 30%; left: 15%;"></div>
                <div class="house" style="top: 30%; left: 85%;"></div>
                <div class="house" style="top: 50%; left: 30%;"></div>
                <div class="house" style="top: 50%; left: 70%;"></div>
                <div class="house" style="top: 70%; left: 15%;"></div>
                <div class="house" style="top: 70%; left: 85%;"></div>
                <div class="house" style="top: 85%; left: 15%;"></div>
                <div class="house" style="top: 85%; left: 30%;"></div>
                <div class="house" style="top: 85%; left: 70%;"></div>
                <div class="house" style="top: 85%; left: 85%;"></div>
                <div id="gate" class="gate"></div>
                <div class="fortress-wall top"></div>
                <div class="fortress-wall bottom"></div>
                <div class="fortress-wall left"></div>
                <div class="fortress-wall right"></div>
            </div>
        </div>

        <div id="recruitPanel" class="panel">
            <button class="close-panel" onclick="hidePanel('recruit')">√ó</button>
            <h3 class="font-bold mb-4 text-lg">–ù–∞–±–æ—Ä –≤–æ–π—Å–∫</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–π—Å–∫ –¥–ª—è –Ω–∞–π–º–∞ (–º–∞–∫—Å: <span id="maxRecruit">10</span>)</label>
                    <div class="flex gap-2">
                        <input type="number" id="recruitAmount" class="bg-gray-700 rounded px-3 py-2 flex-1" value="10" min="1" max="10" oninput="updateRecruitCost()">
                        <button onclick="recruitTroops()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded transition">–ù–∞–Ω—è—Ç—å</button>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="recruitGoldCost">50</span> –∏ <span id="recruitFoodCost">10</span> –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è –∑–∞ 1 –≤–æ–π—Å–∫–æ</p>
                    <p class="text-xs text-gray-400 mt-1">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span id="totalRecruitGoldCost">500</span> –∏ <span id="totalRecruitFoodCost">100</span> –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è</p>
                    <p id="recruitError" class="text-xs text-red-400 mt-1 hidden"></p>
                </div>
                <div>
                    <h4 class="font-bold mb-2">–¢–µ–∫—É—â–∏–µ –≤–æ–π—Å–∫–∞</h4>
                    <p class="text-sm">–í–æ–π—Å–∫–∞: <span id="troopsDisplayPanel">50</span>/<span id="barracksCapacity">50</span></p>
                    <p class="text-sm">–ù–∞—Å–µ–ª–µ–Ω–∏–µ: <span id="populationDisplayPanel">1000</span></p>
                    <p class="text-sm">–ú–æ–∂–Ω–æ –Ω–∞–Ω—è—Ç—å: <span id="recruitPossible">200</span> –≤–æ–π—Å–∫ (20 –Ω–∞ 100 –∂–∏—Ç–µ–ª–µ–π)</p>
                    <p class="text-sm text-gray-400">–£–ª—É—á—à–∞–π—Ç–µ –∫–∞–∑–∞—Ä–º—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–†–∞–∑–≤–∏—Ç–∏–µ", —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–æ–π—Å–∫! –ù–∞ 100 –∂–∏—Ç–µ–ª–µ–π –º–æ–∂–Ω–æ –Ω–∞–Ω—è—Ç—å –¥–æ 20 —Å–æ–ª–¥–∞—Ç.</p>
                    <p class="text-sm">–ü—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –Ω–∞ –∞—Ä–º–∏—é: <span id="armyFoodConsumption">750</span>/–¥–µ–Ω—å</p>
                    <p class="text-sm">–ü—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –Ω–∞ –Ω–∞—Å–µ–ª–µ–Ω–∏–µ: <span id="populationFoodConsumption">237.5</span>/–¥–µ–Ω—å</p>
                </div>
            </div>
        </div>

        <div id="industryPanel" class="panel">
    <button class="close-panel" onclick="hidePanel('industry')">√ó</button>
    <h3 class="font-bold mb-4 text-lg">–†–∞–∑–≤–∏—Ç–∏–µ –∫—Ä–µ–ø–æ—Å—Ç–∏</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="space-y-2">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="font-bold">–§–µ—Ä–º—ã (—É—Ä–æ–≤–µ–Ω—å <span id="farmLevel">1</span>)</span>
            </div>
            <p id="farmProgress" class="text-sm">+100 –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è/–¥–µ–Ω—å, +30 –Ω–∞—Å–µ–ª–µ–Ω–∏—è/–¥–µ–Ω—å</p>
            <div class="w-full bg-gray-700 rounded-full h-2.5">
                <div id="farmProgressBar" class="bg-green-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
            </div>
            <button onclick="upgradeFarms()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded transition w-full">
                –£–ª—É—á—à–∏—Ç—å (<span id="farmCost">500</span>)
            </button>
        </div>
        <div class="space-y-2">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
                <span class="font-bold">–ö–∞–∑–∞—Ä–º—ã (—É—Ä–æ–≤–µ–Ω—å <span id="barracksLevel">1</span>)</span>
            </div>
            <p id="barracksProgress" class="text-sm">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: 50 –≤–æ–π—Å–∫</p>
            <div class="w-full bg-gray-700 rounded-full h-2.5">
                <div id="barracksProgressBar" class="bg-red-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
            </div>
            <button onclick="upgradeBarracks()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition w-full">
                –£–ª—É—á—à–∏—Ç—å (<span id="barracksCost">800</span>)
            </button>
        </div>
        <div class="space-y-2">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                <span class="font-bold">–ñ–∏–ª—ã–µ –∫–≤–∞—Ä—Ç–∞–ª—ã (—É—Ä–æ–≤–µ–Ω—å <span id="houseLevel">1</span>)</span>
            </div>
            <p id="houseProgress" class="text-sm">+30 –Ω–∞—Å–µ–ª–µ–Ω–∏—è/–¥–µ–Ω—å</p>
            <div class="w-full bg-gray-700 rounded-full h-2.5">
                <div id="houseProgressBar" class="bg-blue-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
            </div>
            <button onclick="upgradeHouses()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition w-full">
                –£–ª—É—á—à–∏—Ç—å (<span id="houseCost">600</span>)
            </button>
        </div>
        <div class="space-y-2">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                <span class="font-bold">–ü—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ</span>
            </div>
            <div class="flex gap-2">
                <input type="number" id="buyFoodAmount" class="bg-gray-700 rounded px-3 py-2 flex-1" value="100" min="10" step="10">
                <button onclick="buyFood()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded transition">
                    –ö—É–ø–∏—Ç—å
                </button>
            </div>
            <p class="text-xs text-gray-400 mt-1">–¶–µ–Ω–∞: 2 –∑–∞ 1 –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ</p>
            <p class="text-xs text-gray-400 mt-1">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span id="totalFoodCost">200</span></p>
        </div>
        <div class="space-y-2">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                <span class="font-bold">–ü—Ä–æ–¥–∞—Ç—å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ</span>
            </div>
            <div class="flex gap-2">
                <input type="number" id="sellFoodAmount" class="bg-gray-700 rounded px-3 py-2 flex-1" value="100" min="10" step="10" oninput="updateSellFoodCost()">
                <button onclick="sellFood()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded transition">
                    –ü—Ä–æ–¥–∞—Ç—å
                </button>
            </div>
            <p class="text-xs text-gray-400 mt-1">–¶–µ–Ω–∞: 1 –∑–∞ 1 –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ</p>
            <p class="text-xs text-gray-400 mt-1">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞: <span id="totalSellFoodCost">100</span></p>
        </div>
    </div>
</div>

        <div id="battleSummaryModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="bg-gray-800 p-6 rounded-lg max-w-md w-full">
                <h2 class="text-2xl font-bold mb-4 text-center">–ò—Ç–æ–≥–∏ –±–∏—Ç–≤—ã</h2>
                <p class="mb-2 text-center"><span id="battleResult"></span></p>
                <p class="mb-2 text-center">–í–∞—à–∏ –ø–æ—Ç–µ—Ä–∏: <span id="defenderLosses" class="font-bold">0</span> –≤–æ–π—Å–∫</p>
                <p class="mb-4 text-center">–í—Ä–∞–∂–µ—Å–∫–∏–µ –ø–æ—Ç–µ—Ä–∏: <span id="enemyLosses" class="font-bold">0</span> –≤–æ–π—Å–∫</p>
                <p class="mb-4 text-center text-sm text-gray-400">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: <span id="battleRewards"></span></p>
                <div class="flex justify-center">
                    <button onclick="hideBattleSummaryModal()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>

        <div id="starvationModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="bg-gray-900 p-6 rounded-lg max-w-md w-full text-center">
                <h2 class="text-2xl font-bold mb-4 text-red-500">‚ò†Ô∏è –ì–æ–ª–æ–¥! ‚ò†Ô∏è</h2>
                <p class="mb-4 text-xl"><span id="starvationPopulationLost">0</span> –∂–∏—Ç–µ–ª–µ–π —É–º–µ—Ä–ª–æ –æ—Ç –≥–æ–ª–æ–¥–∞!</p>
                <p class="text-sm text-gray-400">–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∫—É–ø–∏—Ç–µ –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç–µ –∞—Ä–º–∏—é</p>
                <button onclick="document.getElementById('starvationModal').classList.add('hidden');"
                    class="mt-4 bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition">
                    –ü–æ–Ω—è—Ç–Ω–æ
                </button>
            </div>
        </div>

        <div id="enemyWaveModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-800 p-6 rounded-lg max-w-md w-full">
        <h2 class="text-2xl font-bold mb-4 text-center">–í—ã–∑–≤–∞—Ç—å –≤–æ–ª–Ω—É –≤—Ä–∞–≥–æ–≤</h2>
        <p class="mb-2 text-center">–í–æ–ª–Ω–∞ <span id="enemyWaveNumber">1</span></p>
        <p class="mb-2 text-center">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–∞–≥–æ–≤: <span id="enemyWaveCount">100</span></p>
        <p class="mb-4 text-center text-sm text-gray-400">–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –≤–æ–ª–Ω—ã: <span id="nextWaveIncrease">100</span></p>
        <div class="flex justify-center gap-4">
            <button onclick="callEnemyWave()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition">–í—ã–∑–≤–∞—Ç—å</button>
            <button onclick="hideEnemyWaveModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded transition">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>
        <div id="taxReportModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-800 p-6 rounded-lg max-w-md w-full">
        <h2 class="text-2xl font-bold mb-4 text-center">–ù–∞–ª–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç</h2>
        <p class="mb-4 text-center">–°–æ–±—Ä–∞–Ω–æ: <span id="taxAmount">0</span> –¥–∏–Ω–æ</p>
        <div class="flex justify-center gap-4">
            <button onclick="hideTaxReportModal()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button onclick="disableTaxModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded transition">–ë–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å</button>
        </div>
    </div>
</div>

        <div id="tradePanel" class="panel">
    <button class="close-panel" onclick="hidePanel('trade')">√ó</button>
    <h3 class="font-bold mb-4 text-lg">–¢–æ—Ä–≥–æ–≤—ã–π –ø–æ—Ä—Ç–∞–ª DINO</h3>
    <div class="flex mb-4">
        <button id="caravansTab" class="flex-1 bg-gray-700 py-2 rounded-l-lg text-sm font-bold" onclick="showTab('caravans')">–ö–∞—Ä–∞–≤–∞–Ω—ã</button>
        <button id="marketTab" class="flex-1 bg-gray-600 py-2 rounded-r-lg text-sm" onclick="showTab('market')">–†—ã–Ω–æ–∫</button>
    </div>
    <div id="caravansContent" class="tab-content">
        <h4 class="font-bold mb-2">–ö–∞—Ä–∞–≤–∞–Ω—ã</h4>
        <p class="text-sm text-gray-300 mb-4">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –∫–∞—Ä–∞–≤–∞–Ω—ã –≤ –¥—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞</p>
        <div class="space-y-4">
            <div class="bg-gray-700 p-3 rounded-lg">
                <input type="number" id="caravanAmount" class="bg-gray-600 rounded px-3 py-2 w-full mb-2" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (100-500,000)" min="100" max="500000" oninput="updateCaravanInfo()">
                <p class="text-xs text-gray-400 mb-2" id="caravanInfo"></p>
                <button onclick="startCaravan()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded w-full text-sm">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
            <div id="caravanList" class="space-y-2"></div>
            <p class="text-xs text-gray-400 mt-4">–†–∏—Å–∫–∏ –∏ –Ω–∞–≥—Ä–∞–¥—ã:<br>
                100‚Äì1000: 10% —Ä–∏—Å–∫, 10% –Ω–∞–≥—Ä–∞–¥–∞<br>
                1000‚Äì10,000: 30% —Ä–∏—Å–∫, 30% –Ω–∞–≥—Ä–∞–¥–∞<br>
                10,000‚Äì100,000: 50% —Ä–∏—Å–∫, 40% –Ω–∞–≥—Ä–∞–¥–∞<br>
                100,000‚Äì500,000: 70% —Ä–∏—Å–∫, 55% –Ω–∞–≥—Ä–∞–¥–∞
            </p>
        </div>
    </div>
    <div id="marketContent" class="tab-content hidden">
        <h4 class="font-bold mb-2">–†—ã–Ω–æ–∫</h4>
        <p class="text-sm text-gray-300 mb-4">–ü–æ–∫—É–ø–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã —É –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤</p>
        <div id="marketOffers" class="space-y-4"></div>
    </div>
</div>


        <div id="statsPanel" class="panel">
    <button class="close-panel" onclick="hidePanel('stats')">√ó</button>
    <h3 class="font-bold mb-4 text-lg">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—Ä–µ–ø–æ—Å—Ç–∏</h3>
    <div class="stats-grid">
        <div class="stats-card">
            <h4 class="font-bold mb-2">üí∞ –§–∏–Ω–∞–Ω—Å—ã</h4>
            <p class="text-sm">–ë–∞–ª–∞–Ω—Å: <span id="statsBalance">10000</span></p>
        </div>
        <div class="stats-card">
            <h4 class="font-bold mb-2">üçû –ü—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ</h4>
            <p class="text-sm">–¢–µ–∫—É—â–∏–µ –∑–∞–ø–∞—Å—ã: <span id="statsFood">500</span></p>
            <p class="text-sm">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ: <span id="statsFoodProduction">100</span>/–¥–µ–Ω—å</p>
            <p class="text-sm">–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ: <span id="statsFoodConsumption">987.5</span>/–¥–µ–Ω—å</p>
        </div>
        <div class="stats-card">
            <h4 class="font-bold mb-2">üë• –ù–∞—Å–µ–ª–µ–Ω–∏–µ</h4>
            <p class="text-sm">–í—Å–µ–≥–æ –∂–∏—Ç–µ–ª–µ–π: <span id="statsPopulation">1000</span></p>
            <p class="text-sm">–ü—Ä–∏—Ä–æ—Å—Ç: <span id="statsPopulationGrowth">60</span>/–¥–µ–Ω—å</p>
        </div>
        <div class="stats-card">
            <h4 class="font-bold mb-2">‚öîÔ∏è –ê—Ä–º–∏—è</h4>
            <p class="text-sm">–í–æ–π—Å–∫: <span id="statsTroops">50</span>/50</p>
            <p class="text-sm">–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ: <span id="statsArmyConsumption">750</span>/–¥–µ–Ω—å</p>
            <p class="text-sm">–ú–æ–∂–Ω–æ –Ω–∞–Ω—è—Ç—å: <span id="statsRecruitPossible">200</span></p>
        </div>
        <div class="stats-card col-span-2">
            <h4 class="font-bold mb-2">üìà –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h4>
            <p class="text-sm">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ–ª–¥–∞—Ç: <span id="statsArmyEfficiency">110%</span> (–±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å)</p>
            <p class="text-sm">–°—á–∞—Å—Ç—å–µ –∂–∏—Ç–µ–ª–µ–π: <span id="statsHappiness">100%</span></p>
        </div>
    </div>
</div>

  <div class="bottom-menu flex justify-around py-2 z-40 text-xs">
    <button onclick="showPanel('recruit')" class="menu-item flex flex-col items-center text-sm px-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
            <path d="M12 2s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        </svg>
        <span>–ê—Ä–º–∏—è</span>
    </button>
    <button onclick="showPanel('industry')" class="menu-item flex flex-col items-center text-sm px-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
            <path d="M3 3v18h18"></path>
            <path d="M18 8V3"></path>
            <path d="M8 3v5"></path>
            <path d="M8 8v5"></path>
            <path d="M13 3v5"></path>
            <path d="M13 8v5"></path>
        </svg>
        <span>–†–∞–∑–≤–∏—Ç–∏–µ</span>
    </button>

      <button onclick="showEnemyWaveModal()" class="menu-item flex flex-col items-center text-sm px-2">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828l-4.95-4.95M14.828 9.172l-4.95 4.95M5.636 5.636L4.222 4.222m15.556 0l-1.414 1.414M4.222 19.778l1.414-1.414m15.556 0l-1.414 1.414M12 6v6m0 0l3-3m-3 3l-3-3"/>
    </svg>
    <span>–í—ã–∑–≤–∞—Ç—å –≤–æ–ª–Ω—É</span>
</button>

    <button onclick="showPanel('trade')" class="menu-item flex flex-col items-center text-sm px-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
            <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
        <span>–¢–æ—Ä–≥–æ–≤–ª—è</span>
    </button>
    <button onclick="showPanel('stats')" class="menu-item flex flex-col items-center text-sm px-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
            <path d="M12 20V10"></path>
            <path d="M18 20V4"></path>
            <path d="M6 20v-4"></path>
        </svg>
        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
    </button>
</div>

    <script>

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        let gameState = {
    balance: 10000,
    food: 500,
    troops: 50,
    population: 1000,
    day: 1,
    farmLevel: 1,
    barracksLevel: 1,
    houseLevel: 1,
    taxRate: 0.1,
    happiness: 1.0,
    showTaxModal: true, // –ù–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    progress: {
        farm: 0,
        barracks: 0,
        house: 0
    },
    inBattle: false,
    enemyWave: 0,
    victory: false,
    activeCaravans: [],
    battle: {
        defenderHealth: 100,
        enemyHealth: 100,
        defenderInitial: 0,
        enemyInitial: 0
    }
};

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
const fortressBalance = document.getElementById('fortressBalance');
const foodDisplay = document.getElementById('food');
const troopsDisplay = document.getElementById('troopsDisplay');
const populationDisplay = document.getElementById('populationDisplay');
const dayCounter = document.getElementById('dayCounter');
const map = document.getElementById('map');
const fortress = document.getElementById('fortress');
const gate = document.getElementById('gate');
const maxRecruitDisplay = document.getElementById('maxRecruit');
const recruitError = document.getElementById('recruitError');
const battlefield = document.getElementById('battlefield');
const battleSummaryModal = document.getElementById('battleSummaryModal');
const battleResult = document.getElementById('battleResult');
const defenderLosses = document.getElementById('defenderLosses');
const enemyLosses = document.getElementById('enemyLosses');
const battleRewards = document.getElementById('battleRewards');
const recruitPossible = document.getElementById('recruitPossible');
const tradeModal = document.getElementById('tradeModal');
const farmCostDisplay = document.getElementById('farmCost');
const barracksCostDisplay = document.getElementById('barracksCost');
const houseCostDisplay = document.getElementById('houseCost');

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –¥–Ω–µ–π
       let dayTimer;
function startDayTimer() {
    if (!dayTimer) {
        dayTimer = setInterval(nextDay, 15000);
        console.log("Day timer started"); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
    }
}

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ localStorage
        function loadGame() {
            try {
                const saved = localStorage.getItem('dinoSave');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    gameState = { ...gameState, ...parsed };
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã:', e);
                showPopup('‚ùå –ù–µ –º–æ–≥—É –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ!');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ localStorage
        function saveGame() {
            try {
                localStorage.setItem('dinoSave', JSON.stringify(gameState));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã:', e);
                showPopup('‚ùå –ù–µ –º–æ–≥—É —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ!');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function updateBalanceDisplay() {
            if (fortressBalance) {
                fortressBalance.textContent = gameState.balance.toLocaleString();
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        function updateBalance(amount) {
            if (amount < 0 && Math.abs(amount) > gameState.balance) {
                showPopup('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                return false;
            }
            gameState.balance = Math.max(0, gameState.balance + amount);
            updateBalanceDisplay();
            updateStats();
            saveGame();
            return true;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            updateBalanceDisplay();
            updateResources();
            updateIndustryLevels();
            createForest();
            createCitizens();
            taxRateInput.addEventListener('input', () => {
                gameState.taxRate = taxRateInput.value / 100;
                gameState.happiness = Math.max(0.6, Math.min(1.4, 1.0 + (0.2 - gameState.taxRate) * 2));
                updateIndustryLevels();
                updateStats();
            });
            updateRecruitCost();
            updateFoodCost();
            updateStats();
        }


        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å
        function showPanel(panelName) {
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(`${panelName}Panel`).classList.add('active');
            if (panelName === 'recruit') {
                updateRecruitInfo();
            }
            if (panelName === 'stats') {
                updateStats();
            }
        }

        // –°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å
        function hidePanel(panelName) {
            document.getElementById(`${panelName}Panel`).classList.remove('active');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
    document.getElementById('statsBalance').textContent = gameState.balance.toLocaleString();
    document.getElementById('statsFood').textContent = gameState.food.toLocaleString();
    document.getElementById('statsFoodProduction').textContent = (gameState.farmLevel * 200).toLocaleString();
    document.getElementById('statsFoodConsumption').textContent = (gameState.troops * 5 + (gameState.population - gameState.troops) * 0.1).toFixed(1);
    document.getElementById('statsPopulation').textContent = gameState.population.toLocaleString();
    document.getElementById('statsPopulationGrowth').textContent = Math.floor((gameState.farmLevel * 30 + gameState.houseLevel * 30) * gameState.happiness).toLocaleString();
    document.getElementById('statsTroops').textContent = gameState.troops.toLocaleString();
    document.getElementById('statsArmyConsumption').textContent = (gameState.troops * 5).toLocaleString();
    document.getElementById('statsRecruitPossible').textContent = Math.floor(gameState.population / 5).toLocaleString();
    document.getElementById('statsArmyEfficiency').textContent = `${100 + (gameState.barracksLevel * 10)}%`;
    document.getElementById('statsHappiness').textContent = `${Math.floor(gameState.happiness * 100)}%`;
}

        // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ—Å–∞
        function createForest() {
            for (let i = 0; i < 100; i++) {
                const tree = document.createElement('div');
                tree.className = 'tree';
                let x, y;
                do {
                    x = Math.random() * 100;
                    y = Math.random() * 100;
                } while (x > 20 && x < 80 && y > 20 && y < 80);
                tree.style.left = `${x}%`;
                tree.style.top = `${y}%`;
                const trunk = document.createElement('div');
                trunk.className = 'tree-trunk';
                trunk.style.left = `${x}%`;
                trunk.style.top = `${y}%`;
                map.appendChild(tree);
                map.appendChild(trunk);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∂–∏—Ç–µ–ª–µ–π
        function createCitizens() {
            for (let i = 0; i < 20; i++) {
                const citizen = document.createElement('div');
                citizen.className = 'citizen';
                const angle = Math.random() * Math.PI * 2;
                const radius = 10 + Math.random() * 15;
                citizen.style.left = `${50 + Math.cos(angle) * radius}%`;
                citizen.style.top = `${50 + Math.sin(angle) * radius}%`;
                citizen.style.animationDelay = `${i * 0.5}s`;
                fortress.appendChild(citizen);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–æ–≤
        function createFireworks() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    const colors = ['#ff0000', '#ffff00', '#00ff00', '#00ffff', '#0000ff', '#ff00ff'];
                    firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.left = `${40 + Math.random() * 20}%`;
                    firework.style.top = `${30 + Math.random() * 20}%`;
                    map.appendChild(firework);
                    setTimeout(() => firework.remove(), 1000);
                }, i * 200);
            }
        }

        // –†–∞—Å—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—Ä–∞–≥–æ–≤
        function calculateEnemyCount() {
    let base = 100 * gameState.enemyWave;
    if (gameState.enemyWave === 1) return 100; // –ü–µ—Ä–≤–∞—è –≤–æ–ª–Ω–∞ –≤—Å–µ–≥–¥–∞ 100 –≤—Ä–∞–≥–æ–≤
    if (gameState.enemyWave % 5 === 0) base += 300;
    if (gameState.enemyWave === 10) base += 600;
    if (gameState.enemyWave === 15) base += 1200;
    if (gameState.enemyWave > 15 && (gameState.enemyWave - 15) % 5 === 0) base += 600;
    return base;
}

        // –†–∞—Å—Å—á—ë—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π –≤–æ–ª–Ω—ã
        function calculateNextWaveIncrease() {
            let increase = 100;
            if ((gameState.enemyWave + 1) % 5 === 0) increase += 500;
            if (gameState.enemyWave + 1 === 10) increase += 1000;
            if (gameState.enemyWave + 1 === 15) increase += 2000;
            if (gameState.enemyWave + 1 > 15 && ((gameState.enemyWave + 1) - 15) % 5 === 0) increase += 1000;
            return increase;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–æ–ª–Ω—ã –≤—Ä–∞–≥–æ–≤
        function showEnemyWaveModal() {
    if (gameState.inBattle) {
        showPopup("–£–∂–µ –∏–¥–µ—Ç –±–∏—Ç–≤–∞!");
        return;
    }
    const enemyCount = calculateEnemyCount();
    const nextIncrease = calculateNextWaveIncrease();
    document.getElementById('enemyWaveNumber').textContent = (gameState.enemyWave + 1).toLocaleString();
    document.getElementById('enemyWaveCount').textContent = enemyCount.toLocaleString();
    document.getElementById('nextWaveIncrease').textContent = nextIncrease.toLocaleString();
    document.getElementById('enemyWaveModal').classList.remove('hidden');
}

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–æ–ª–Ω—ã –≤—Ä–∞–≥–æ–≤
        function hideEnemyWaveModal() {
            document.getElementById('enemyWaveModal').classList.add('hidden');
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Ç–æ–≥–æ–≤ –±–∏—Ç–≤—ã
        function hideBattleSummaryModal() {
            battleSummaryModal.classList.add('hidden');
        }

        function hideTaxReportModal() {
    document.getElementById('taxReportModal').classList.add('hidden');
}
       function hideTaxReportModal() {
    document.getElementById('taxReportModal').classList.add('hidden');
}

function disableTaxModal() {
    gameState.showTaxModal = false;
    hideTaxReportModal();
    saveGame();
}

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–∞–π–º–∞
        function updateRecruitCost() {
            const amount = parseInt(document.getElementById('recruitAmount').value) || 0;
            document.getElementById('totalRecruitGoldCost').textContent = amount * 50;
            document.getElementById('totalRecruitFoodCost').textContent = amount * 5;
            const foodNeeded = gameState.troops * 5 + (gameState.population - gameState.troops) * 0.1 + amount * 5;
            const foodAvailable = gameState.food;
            if (amount > 0 && foodNeeded > foodAvailable) {
                recruitError.textContent = `–ù–µ —Ö–≤–∞—Ç–∏—Ç –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è! –ù—É–∂–Ω–æ ${foodNeeded}, –µ—Å—Ç—å ${foodAvailable}`;
                recruitError.classList.remove('hidden');
            } else {
                recruitError.classList.add('hidden');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –µ–¥—ã
        function updateFoodCost() {
            const amount = parseInt(document.getElementById('buyFoodAmount').value) || 0;
            document.getElementById('totalFoodCost').textContent = amount * 2;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–∞–π–º–µ
        function updateRecruitInfo() {
            const maxRecruit = Math.floor(gameState.population / 5);
            const maxPossible = Math.min(maxRecruit, gameState.barracksLevel * 50 - gameState.troops);
            maxRecruitDisplay.textContent = maxPossible;
            recruitPossible.textContent = maxRecruit;
            document.getElementById('recruitAmount').max = maxPossible;
            document.getElementById('recruitAmount').value = Math.min(parseInt(document.getElementById('recruitAmount').value) || 0, maxPossible);
            updateRecruitCost();
            updateStats();
        }

        // –ù–∞–Ω—è—Ç—å –≤–æ–π—Å–∫–∞
        function recruitTroops() {
            const maxRecruit = Math.floor(gameState.population / 5);
            const maxPossible = Math.min(maxRecruit, gameState.barracksLevel * 50 - gameState.troops);
            let amount = parseInt(document.getElementById('recruitAmount').value) || 0;
            amount = Math.max(1, Math.min(amount, maxPossible));
            if (amount <= 0) {
                showPopup("–ù–µ–ª—å–∑—è –Ω–∞–Ω—è—Ç—å 0 –∏–ª–∏ –º–µ–Ω—å—à–µ –≤–æ–π—Å–∫!");
                return;
            }
            const foodNeeded = gameState.troops * 5 + (gameState.population - gameState.troops) * 0.1 + amount * 5;
            if (gameState.food < foodNeeded) {
                showPopup(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è! –ù—É–∂–Ω–æ ${foodNeeded}, –µ—Å—Ç—å ${gameState.food}`);
                return;
            }
            const costBalance = amount * 50;
            const costFood = amount * 5;
            if (!updateBalance(-costBalance)) {
                return;
            }
            if (gameState.population < amount) {
                showPopup(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—è –¥–ª—è –Ω–∞–π–º–∞ ${amount} –≤–æ–π—Å–∫!`);
                return;
            }
            gameState.food -= costFood;
            gameState.troops += amount;
            gameState.population -= amount;
            updateResources();
            hidePanel('recruit');
            saveGame();
        }

        // –í—ã–∑–≤–∞—Ç—å –≤–æ–ª–Ω—É –≤—Ä–∞–≥–æ–≤
        function callEnemyWave() {
    if (gameState.inBattle) {
        showPopup("–£–∂–µ –∏–¥–µ—Ç –±–∏—Ç–≤–∞!");
        return;
    }
    hideEnemyWaveModal();
    gameState.enemyWave++;
    const enemyCount = calculateEnemyCount();
    spawnEnemies(enemyCount);
}

        // –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
        // –í —Ñ—É–Ω–∫—Ü–∏–∏ spawnEnemies, –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤–Ω—É—Ç—Ä–∏ defender.innerHTML
function spawnEnemies(count) {
    gameState.inBattle = true;
    gameState.victory = false;
    gameState.battle.defenderHealth = 100;
    gameState.battle.enemyHealth = 100;
    gameState.battle.defenderInitial = Math.min(gameState.troops, gameState.barracksLevel * 50);
    gameState.battle.enemyInitial = count;
    battlefield.innerHTML = '';
    battlefield.classList.remove('hidden');
    const enemyGroup = document.createElement('div');
    enemyGroup.className = 'troop enemy-troop';
    enemyGroup.id = 'enemyTroop';
    enemyGroup.style.left = '90%';
    enemyGroup.style.top = '10%';
    const enemyCountDisplay = document.createElement('div');
    enemyCountDisplay.className = 'troop-count';
    enemyCountDisplay.textContent = count.toLocaleString();
    enemyGroup.appendChild(enemyCountDisplay);
    const enemy = document.createElement('div');
    enemy.innerHTML = `<span style="font-family: 'Arial Black', sans-serif; font-size: 24px;">‚ò†</span><div class="health-bar"><div id="enemyHealth" class="health-fill" style="width:100%"></div></div>`;
    enemyGroup.appendChild(enemy);
    battlefield.appendChild(enemyGroup);
    const defenderCount = Math.min(gameState.troops, gameState.barracksLevel * 50);
    setTimeout(() => {
        enemyGroup.style.left = '70%';
        enemyGroup.style.top = '30%';
        if (defenderCount > 0) {
            const defenderGroup = document.createElement('div');
            defenderGroup.className = 'troop defender-troop';
            defenderGroup.id = 'defenderTroop';
            defenderGroup.style.left = '50%';
            defenderGroup.style.top = '50%';
            const defenderCountDisplay = document.createElement('div');
            defenderCountDisplay.className = 'troop-count';
            defenderCountDisplay.textContent = defenderCount.toLocaleString();
            defenderGroup.appendChild(defenderCountDisplay);
            const defender = document.createElement('div');
            defender.innerHTML = `<span style="font-family: 'Arial Black', sans-serif; font-size: 24px;">D</span><div class="health-bar"><div id="defenderHealth" class="health-fill" style="width:100%"></div></div>`;
            defenderGroup.appendChild(defender);
            battlefield.appendChild(defenderGroup);
            setTimeout(() => {
                gate.classList.add('open');
                defenderGroup.style.left = '65%';
                defenderGroup.style.top = '35%';
                const swords = document.createElement('div');
                swords.className = 'swords';
                swords.innerHTML = '‚öîÔ∏è';
                swords.style.left = '67.5%';
                swords.style.top = '32.5%';
                battlefield.appendChild(swords);
                setTimeout(() => {
                    battlefield.classList.add('active-battle');
                    startBattle(defenderCount, count);
                }, 3000);
            }, 1000);
        } else {
            setTimeout(() => {
                endBattle(0, count);
            }, 3000);
        }
    }, 2000);
}

        // –ó–∞–ø—É—Å–∫ –±–∏—Ç–≤—ã —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∏ —Ä–∞—Å—á–µ—Ç–æ–º –ø–æ—Ç–µ—Ä—å
        function startBattle(defenderCount, enemyCount) {
    const defenderHealth = document.getElementById('defenderHealth');
    const enemyHealth = document.getElementById('enemyHealth');
    const defenderTroop = document.getElementById('defenderTroop');
    const enemyTroop = document.getElementById('enemyTroop');

    let defenderPower = defenderCount * (1 + gameState.barracksLevel * 0.1);
    let enemyPower = enemyCount * 1.2; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∏–ª—ã –≤—Ä–∞–≥–æ–≤ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞

    const battleInterval = setInterval(() => {
        // –†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞
        const defenderDamage = Math.random() * defenderPower * 0.05;
        const enemyDamage = Math.random() * enemyPower * 0.06;

        defenderPower -= enemyDamage;
        enemyPower -= defenderDamage;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è
        const defenderPercent = Math.max(0, Math.min(100, defenderPower / (defenderCount * (1 + gameState.barracksLevel * 0.1)) * 100));
        const enemyPercent = Math.max(0, Math.min(100, enemyPower / enemyCount * 100));

        defenderHealth.style.width = `${defenderPercent}%`;
        enemyHealth.style.width = `${enemyPercent}%`;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–π—Å–∫
        const currentDefenders = Math.floor(defenderPower / (1 + gameState.barracksLevel * 0.1));
        const currentEnemies = Math.floor(enemyPower / 1.2);

        defenderTroop.querySelector('.troop-count').textContent = currentDefenders.toLocaleString();
        enemyTroop.querySelector('.troop-count').textContent = currentEnemies.toLocaleString();

        // –ö–æ–Ω–µ—Ü –±–∏—Ç–≤—ã
        if (defenderPower <= 0 || enemyPower <= 0) {
            clearInterval(battleInterval);
            endBattle(Math.max(0, currentDefenders), Math.max(0, currentEnemies));
        }
    }, 300);
}

// –õ–æ–≥–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∏—Ç–≤—ã
// –õ–æ–≥–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∏—Ç–≤—ã
function endBattle(defenderCount, enemyCount) {
    battlefield.classList.remove('active-battle');
    gate.classList.remove('open');
    let resultText = "";
    let balanceEarned = 0;
    let foodEarned = 0;
    let troopsLost = gameState.battle.defenderInitial - defenderCount;
    let enemyLost = gameState.battle.enemyInitial - enemyCount;
    let populationLost = 0;
    let balanceLost = 0;

    const fortressBonus = 1 + (gameState.barracksLevel + gameState.farmLevel + gameState.houseLevel) * 0.05;
    const defenderStrength = defenderCount * fortressBonus;
    const enemyStrength = enemyCount * 1.2;

    if (defenderCount === 0) {
        populationLost = Math.floor(gameState.population * 0.3);
        balanceLost = Math.floor(gameState.balance * 0.2);
        resultText = `–í—Ä–∞–≥–∏ –∑–∞—Ö–≤–∞—Ç–∏–ª–∏ –∫—Ä–µ–ø–æ—Å—Ç—å!`;
        gameState.population = Math.max(100, gameState.population - populationLost);
        updateBalance(-balanceLost);
    } else if (defenderStrength > enemyStrength * 1.2) {
        gameState.victory = true;
        const victoryRatio = (defenderStrength - enemyStrength) / defenderStrength;
        balanceEarned = Math.floor(gameState.battle.enemyInitial * 890); // –£–≤–µ–ª–∏—á–µ–Ω –ø—Ä–∏–∑
        foodEarned = Math.floor(gameState.battle.enemyInitial * 3);
        troopsLost = Math.floor(troopsLost * (1 - victoryRatio * 0.8));
        enemyLost = gameState.battle.enemyInitial;
        resultText = `–†–µ—à–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–±–µ–¥–∞!`;
        createFireworks();
    } else if (defenderStrength > enemyStrength) {
        gameState.victory = true;
        const victoryRatio = (defenderStrength - enemyStrength) / enemyStrength;
        balanceEarned = Math.floor(gameState.battle.enemyInitial * 445); // –£–≤–µ–ª–∏—á–µ–Ω –ø—Ä–∏–∑
        foodEarned = Math.floor(gameState.battle.enemyInitial * 1.5);
        troopsLost = Math.floor(troopsLost * (1 - victoryRatio * 0.5));
        enemyLost = Math.floor(gameState.battle.enemyInitial * 0.9);
        resultText = `–í—ã –ø–æ–±–µ–¥–∏–ª–∏!`;
        createFireworks();
    } else {
        const lossRatio = (enemyStrength - defenderStrength) / enemyStrength;
        troopsLost = Math.floor(troopsLost * (1 + lossRatio * 0.2));
        enemyLost = Math.floor(gameState.battle.enemyInitial * 0.6);
        populationLost = Math.floor(gameState.population * 0.2);
        balanceLost = Math.floor(gameState.balance * 0.1);
        resultText = `–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!`;
        gameState.population = Math.max(100, gameState.population - populationLost);
        updateBalance(-balanceLost);
    }

    // –ò–Ω–æ–≥–¥–∞ —É–º–µ–Ω—å—à–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
    if (gameState.victory && Math.random() < 0.3) {
        balanceEarned = Math.floor(balanceEarned * 0.7); // 30% —à–∞–Ω—Å —É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É –Ω–∞ 30%
    }

    gameState.troops = Math.max(0, gameState.troops - troopsLost);
    updateBalance(balanceEarned);
    gameState.food += foodEarned;
    gameState.inBattle = false;
    battleResult.textContent = resultText;
    defenderLosses.textContent = troopsLost.toLocaleString();
    enemyLosses.textContent = enemyLost.toLocaleString();

    let rewardsText = "";
    if (gameState.victory && defenderCount > 0) {
        rewardsText = `–ü–æ–ª—É—á–µ–Ω–æ: ${balanceEarned.toLocaleString()} –¥–∏–Ω–æ, ${foodEarned.toLocaleString()} –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è.`;
    } else {
        rewardsText = `–ü–æ—Ç–µ—Ä—è–Ω–æ: ${populationLost.toLocaleString()} –Ω–∞—Å–µ–ª–µ–Ω–∏—è, ${balanceLost.toLocaleString()} –¥–∏–Ω–æ.`;
    }
    battleRewards.textContent = rewardsText;
    battleSummaryModal.classList.remove('hidden');
    setTimeout(() => {
        battlefield.innerHTML = '';
        battlefield.classList.add('hidden');
        updateResources();
        saveGame();
        restartDayTimer(); // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –ø–æ—Å–ª–µ –±–∏—Ç–≤—ã
    }, 2000);
}
        // –£–ª—É—á—à–µ–Ω–∏–µ —Ñ–µ—Ä–º
       function upgradeFarms() {
    const cost = Math.floor(500 * Math.pow(2, gameState.farmLevel - 1));
    if (!updateBalance(-cost)) {
        return;
    }
    gameState.progress.farm = 0;
    document.getElementById('farmProgressBar').style.width = '0%';
    const upgradeInterval = setInterval(() => {
        gameState.progress.farm += 10;
        document.getElementById('farmProgressBar').style.width = `${gameState.progress.farm}%`;
        if (gameState.progress.farm >= 100) {
            clearInterval(upgradeInterval);
            gameState.farmLevel++;
            updateIndustryLevels();
            updateStats();
            saveGame();
        }
    }, 100);
}

function upgradeBarracks() {
    const cost = Math.floor(800 * Math.pow(2, gameState.barracksLevel - 1));
    if (!updateBalance(-cost)) {
        return;
    }
    gameState.progress.barracks = 0;
    document.getElementById('barracksProgressBar').style.width = '0%';
    const upgradeInterval = setInterval(() => {
        gameState.progress.barracks += 10;
        document.getElementById('barracksProgressBar').style.width = `${gameState.progress.barracks}%`;
        if (gameState.progress.barracks >= 100) {
            clearInterval(upgradeInterval);
            gameState.barracksLevel++;
            updateIndustryLevels();
            updateStats();
            saveGame();
        }
    }, 100);
}

function upgradeHouses() {
    const cost = Math.floor(600 * Math.pow(2, gameState.houseLevel - 1));
    if (!updateBalance(-cost)) {
        return;
    }
    gameState.progress.house = 0;
    document.getElementById('houseProgressBar').style.width = '0%';
    const upgradeInterval = setInterval(() => {
        gameState.progress.house += 10;
        document.getElementById('houseProgressBar').style.width = `${gameState.progress.house}%`;
        if (gameState.progress.house >= 100) {
            clearInterval(upgradeInterval);
            gameState.houseLevel++;
            updateIndustryLevels();
            updateStats();
            saveGame();
        }
    }, 100);
}
        // –ü–æ–∫—É–ø–∫–∞ –µ–¥—ã
        function buyFood() {
            const amount = parseInt(document.getElementById('buyFoodAmount').value) || 0;
            if (amount <= 0) {
                showPopup("–ù–µ–ª—å–∑—è –∫—É–ø–∏—Ç—å 0 –∏–ª–∏ –º–µ–Ω—å—à–µ –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è!");
                return;
            }
            const cost = amount * 2;
            if (!updateBalance(-cost)) {
                return;
            }
            gameState.food += amount;
            updateResources();
            updateFoodCost();
            saveGame();
        }

        // –ù–æ–≤—ã–π –¥–µ–Ω—å
        function nextDay() {
            if (gameState.inBattle) {
                showPopup("–ù–µ–ª—å–∑—è –∑–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å –≤–æ –≤—Ä–µ–º—è –±–∏—Ç–≤—ã!");
                return;
            }
            gameState.day++;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞—Ä–∞–≤–∞–Ω–æ–≤
            checkCaravans();

            const mineIncome = gameState.mines > 0 ? 300 + (gameState.mines-1)*200 : 0;
            updateBalance(mineIncome);

            const populationGrowth = Math.floor((gameState.farmLevel * 30 + gameState.houseLevel * 30) * gameState.happiness);
            gameState.population += populationGrowth;

            // –£–≤–µ–ª–∏—á–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–µ—Ä–º
            gameState.food += gameState.farmLevel * 200;

            const foodConsumption = gameState.troops * 5 + (gameState.population - gameState.troops) * 0.1;
            gameState.food = Math.max(0, gameState.food - foodConsumption);

            if (gameState.food <= 0) {
                const populationLost = Math.floor(gameState.population * 0.15);
                gameState.population = Math.max(0, gameState.population - populationLost);
                document.getElementById('starvationModal').classList.remove('hidden');
                document.getElementById('starvationPopulationLost').textContent = populationLost;
                gameState.food = 0;
            }

            updateResources();
            updateIndustryLevels();
            updateStats();
            saveGame();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        function updateResources() {
            dayCounter.textContent = gameState.day;
            foodDisplay.textContent = Math.floor(gameState.food);
            troopsDisplay.textContent = gameState.troops;
            populationDisplay.textContent = gameState.population;
            document.getElementById('troopsDisplayPanel').textContent = gameState.troops;
            document.getElementById('populationDisplayPanel').textContent = gameState.population;
            document.getElementById('barracksCapacity').textContent = gameState.barracksLevel * 50;
            document.getElementById('armyFoodConsumption').textContent = (gameState.troops * 5).toFixed(1);
            document.getElementById('populationFoodConsumption').textContent = ((gameState.population - gameState.troops) * 0.1).toFixed(1);
            updateBalanceDisplay();
            updateRecruitInfo();
            updateStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏
       function updateIndustryLevels() {
    document.getElementById('farmLevel').textContent = gameState.farmLevel;
    document.getElementById('barracksLevel').textContent = gameState.barracksLevel;
    document.getElementById('houseLevel').textContent = gameState.houseLevel;
    document.getElementById('farmProgress').textContent = `+${gameState.farmLevel * 200} –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è/–¥–µ–Ω—å, +${gameState.farmLevel * 30} –Ω–∞—Å–µ–ª–µ–Ω–∏—è/–¥–µ–Ω—å`;
    document.getElementById('barracksProgress').textContent = `–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${gameState.barracksLevel * 50} –≤–æ–π—Å–∫`;
    document.getElementById('houseProgress').textContent = `+${gameState.houseLevel * 30} –Ω–∞—Å–µ–ª–µ–Ω–∏—è/–¥–µ–Ω—å`;
    document.getElementById('farmCost').textContent = Math.floor(500 * Math.pow(2, gameState.farmLevel - 1));
    document.getElementById('barracksCost').textContent = Math.floor(800 * Math.pow(2, gameState.barracksLevel - 1));
    document.getElementById('houseCost').textContent = Math.floor(600 * Math.pow(2, gameState.houseLevel - 1));
}

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showPopup(message) {
            const popup = document.createElement('div');
            popup.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            popup.textContent = message;
            document.body.appendChild(popup);
            setTimeout(() => {
                popup.style.transition = 'opacity 0.5s';
                popup.style.opacity = '0';
                setTimeout(() => popup.remove(), 500);
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initGame);
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å (–∑–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é showPanel)
function showPanel(panelName) {
    document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
    document.getElementById(`${panelName}Panel`).classList.add('active');
    if (panelName === 'recruit') {
        updateRecruitInfo();
    }
    if (panelName === 'stats') {
        updateStats();
    }
    if (panelName === 'trade') {
        showTab('caravans'); // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É "–ö–∞—Ä–∞–≤–∞–Ω—ã" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏
function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('#tradePanel button[id$="Tab"]').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`${tabName}Content`).classList.add('active');
    document.getElementById(`${tabName}Tab`).classList.add('active');
    if (tabName === 'market') {
        updateMarketOffers();
    } else {
        updateCaravanInfo();
        updateCaravanList();
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞—Ä–∞–≤–∞–Ω–µ
function updateCaravanInfo() {
    const amount = parseInt(document.getElementById('caravanAmount').value) || 0;
    let risk, reward, duration;
    if (amount >= 100 && amount < 1000) {
        risk = 0.1;
        reward = amount * 0.1;
        duration = 1 + Math.floor(Math.random() * 2);
    } else if (amount < 10000) {
        risk = 0.3;
        reward = amount * 0.3;
        duration = 3 + Math.floor(Math.random() * 3);
    } else if (amount < 100000) {
        risk = 0.5;
        reward = amount * 0.4;
        duration = 5 + Math.floor(Math.random() * 6);
    } else if (amount <= 500000) {
        risk = 0.7;
        reward = amount * 0.55;
        duration = 7 + Math.floor(Math.random() * 8);
    } else {
        document.getElementById('caravanInfo').textContent = '–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 100 –¥–æ 500,000 –¥–∏–Ω–æ!';
        return;
    }
    document.getElementById('caravanInfo').textContent = `–†–∏—Å–∫: ${risk * 100}%, –ù–∞–≥—Ä–∞–¥–∞: ${Math.floor(reward)} –¥–∏–Ω–æ, –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${duration} –¥–Ω–µ–π`;
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä–∞–≤–∞–Ω–∞
function startCaravan() {
    const amount = parseInt(document.getElementById('caravanAmount').value) || 0;
    if (amount < 100 || amount > 500000) {
        showPopup('–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 100 –¥–æ 500,000 –¥–∏–Ω–æ!');
        return;
    }
    if (!updateBalance(-amount)) return;
    let risk, reward, duration;
    if (amount >= 100 && amount < 1000) {
        risk = 0.1;
        reward = amount * 0.1;
        duration = 1 + Math.floor(Math.random() * 2);
    } else if (amount < 10000) {
        risk = 0.3;
        reward = amount * 0.3;
        duration = 3 + Math.floor(Math.random() * 3);
    } else if (amount < 100000) {
        risk = 0.5;
        reward = amount * 0.4;
        duration = 5 + Math.floor(Math.random() * 6);
    } else {
        risk = 0.7;
        reward = amount * 0.55;
        duration = 7 + Math.floor(Math.random() * 8);
    }
    const caravan = {
        amount: amount,
        startDay: gameState.day,
        duration: duration,
        risk: risk,
        reward: Math.floor(reward),
        status: 'traveling'
    };
    gameState.activeCaravans.push(caravan);
    showPopup(`–ö–∞—Ä–∞–≤–∞–Ω –∑–∞ ${amount} –¥–∏–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –í–µ—Ä–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ ${duration} –¥–Ω–µ–π.`);
    animateCaravan(caravan);
    updateCaravanList();
    saveGame();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞—Ä–∞–≤–∞–Ω–æ–≤
function updateCaravanList() {
    const caravanList = document.getElementById('caravanList');
    caravanList.innerHTML = '';
    gameState.activeCaravans.forEach(caravan => {
        const div = document.createElement('div');
        div.className = 'bg-gray-700 p-2 rounded-lg text-sm';
        div.textContent = `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–∞—Ä–∞–≤–∞–Ω –∑–∞ ${caravan.amount} –¥–∏–Ω–æ, –≤–µ—Ä–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑ ${caravan.duration - (gameState.day - caravan.startDay)} –¥–Ω–µ–π`;
        caravanList.appendChild(div);
    });
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ä–∞–≤–∞–Ω–æ–≤ (–∑–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é checkCaravans)
function checkCaravans() {
    const completedCaravans = [];
    gameState.activeCaravans.forEach((caravan, index) => {
        if (gameState.day - caravan.startDay >= caravan.duration) {
            const success = Math.random() > caravan.risk;
            if (success) {
                updateBalance(caravan.reward);
                showPopup(`–ö–∞—Ä–∞–≤–∞–Ω –∑–∞ ${caravan.amount} –¥–∏–Ω–æ –≤–µ—Ä–Ω—É–ª—Å—è —Å ${caravan.reward} –¥–∏–Ω–æ!`);
            } else {
                showPopup(`–ö–∞—Ä–∞–≤–∞–Ω –∑–∞ ${caravan.amount} –¥–∏–Ω–æ —Ä–∞–∑–≥—Ä–∞–±–ª–µ–Ω!`);
            }
            completedCaravans.push(index);
        }
    });
    completedCaravans.reverse().forEach(index => gameState.activeCaravans.splice(index, 1));
    updateCaravanList();
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
let marketOffers = [];
function generateMarketOffers() {
    marketOffers = [];
    const offerTypes = [
        { type: 'food', basePrice: 2, minAmount: 100, maxAmount: 2000, priceVariation: 0.5 },
        { type: 'troops', basePrice: 50, minAmount: 5, maxAmount: 50, priceVariation: 0.4 },
        { type: 'population', basePrice: 20, minAmount: 10, maxAmount: 100, priceVariation: 0.3 }
    ];
    for (let i = 0; i < 50; i++) {
        const type = offerTypes[Math.floor(Math.random() * offerTypes.length)];
        const amount = Math.floor(type.minAmount + Math.random() * (type.maxAmount - type.minAmount));
        const priceFactor = Math.random() < 0.3 ? 0.7 : 0.9 + Math.random() * 0.4; // 30% –¥–µ—à—ë–≤—ã—Ö, 70% —Å—Ä–µ–¥–Ω–∏–µ/–¥–æ—Ä–æ–≥–∏–µ
        const price = Math.floor(amount * type.basePrice * priceFactor);
        marketOffers.push({ type: type.type, amount, price, daysLeft: 3 });
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
function updateMarketOffers() {
    if (gameState.day % 3 === 0) generateMarketOffers();
    const marketOffersDiv = document.getElementById('marketOffers');
    marketOffersDiv.innerHTML = '';
    marketOffers.forEach((offer, index) => {
        const div = document.createElement('div');
        div.className = 'bg-gray-700 p-3 rounded-lg flex justify-between items-center gap-2 hover:bg-gray-600 transition';
        let typeText, icon;
        if (offer.type === 'food') {
            typeText = `${offer.amount} –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è`;
            icon = `<svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>`;
        } else if (offer.type === 'troops') {
            typeText = `${offer.amount} —Å–æ–ª–¥–∞—Ç`;
            icon = `<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 12l6-6m-6 6L6 6m6 6v6m-6-6h12"></path></svg>`;
        } else {
            typeText = `${offer.amount} –∂–∏—Ç–µ–ª–µ–π`;
            icon = `<svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>`;
        }
        div.innerHTML = `
            <div class="flex items-center gap-2">
                ${icon}
                <p class="text-sm">${typeText}</p>
            </div>
            <div class="flex items-center gap-2">
                <p class="text-sm font-bold">${offer.price} –¥–∏–Ω–æ</p>
                <button class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-xs" onclick="buyMarketOffer(${index})">–ö—É–ø–∏—Ç—å</button>
            </div>
            <p class="text-xs text-gray-400 absolute bottom-1 right-3">–û—Å—Ç–∞–ª–æ—Å—å ${offer.daysLeft} –¥–Ω–µ–π</p>
        `;
        marketOffersDiv.appendChild(div);
    });
}

// –ü–æ–∫—É–ø–∫–∞ —Ä—ã–Ω–æ—á–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
function buyMarketOffer(index) {
    const offer = marketOffers[index];
    if (!updateBalance(-offer.price)) return;
    if (offer.type === 'food') {
        gameState.food += offer.amount;
    } else if (offer.type === 'troops') {
        if (gameState.troops + offer.amount > gameState.barracksLevel * 50) {
            showPopup('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –≤ –∫–∞–∑–∞—Ä–º–∞—Ö!');
            updateBalance(offer.price); // –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤
            return;
        }
        gameState.troops += offer.amount;
        gameState.population -= offer.amount;
    } else if (offer.type === 'population') {
        gameState.population += offer.amount;
    }
    marketOffers.splice(index, 1);
    updateMarketOffers();
    updateResources();
    saveGame();
    showPopup(`–ö—É–ø–ª–µ–Ω–æ: ${offer.amount} ${offer.type === 'food' ? '–ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è' : offer.type === 'troops' ? '—Å–æ–ª–¥–∞—Ç' : '–∂–∏—Ç–µ–ª–µ–π'}!`);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ nextDay –¥–ª—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (–∑–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
function nextDay() {
    if (gameState.inBattle) {
        showPopup("–ù–µ–ª—å–∑—è –∑–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å –≤–æ –≤—Ä–µ–º—è –±–∏—Ç–≤—ã!");
        return;
    }
    console.log("nextDay called, current day:", gameState.day); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏

    gameState.day++;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞—Ä–∞–≤–∞–Ω–æ–≤
    checkCaravans();

    // –°–±–æ—Ä –Ω–∞–ª–æ–≥–æ–≤
    const taxPerCitizen = 5; // –ò–∑–º–µ–Ω–µ–Ω–æ —Å 0.5 –Ω–∞ 5
    const taxCollected = Math.floor(gameState.population * taxPerCitizen);
    updateBalance(taxCollected);

    // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –æ—Ç—á—ë—Ç–æ–º, –µ—Å–ª–∏ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ
    if (gameState.showTaxModal) {
        document.getElementById('taxAmount').textContent = taxCollected.toLocaleString();
        document.getElementById('taxReportModal').classList.remove('hidden');
    }

    const mineIncome = gameState.mines > 0 ? 300 + (gameState.mines - 1) * 200 : 0;
    updateBalance(mineIncome);

    const populationGrowth = Math.floor((gameState.farmLevel * 30 + gameState.houseLevel * 30) * gameState.happiness);
    gameState.population += populationGrowth;

    // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è
    gameState.food += gameState.farmLevel * 200;

    const foodConsumption = gameState.troops * 5 + (gameState.population - gameState.troops) * 0.1;
    gameState.food = Math.max(0, gameState.food - foodConsumption);

    if (gameState.food <= 0) {
        const populationLost = Math.floor(gameState.population * 0.15);
        gameState.population = Math.max(0, gameState.population - populationLost);
        document.getElementById('starvationModal').classList.remove('hidden');
        document.getElementById('starvationPopulationLost').textContent = populationLost;
        gameState.food = 0;
    }

    marketOffers.forEach(offer => offer.daysLeft--);
    marketOffers = marketOffers.filter(offer => offer.daysLeft > 0);
    updateMarketOffers();
    updateResources();
    updateIndustryLevels();
    updateStats();
    saveGame();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ initGame –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ (–∑–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
function initGame() {
    loadGame();
    updateBalanceDisplay();
    updateResources();
    updateIndustryLevels();
    createForest();
    createCitizens();
    updateRecruitCost();
    updateFoodCost();
    updateSellFoodCost();
    updateStats();
    generateMarketOffers();
    updateCaravanList();
    startDayTimer(); // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
}

        function updateSellFoodCost() {
    const amount = parseInt(document.getElementById('sellFoodAmount').value) || 0;
    document.getElementById('totalSellFoodCost').textContent = amount;
}

function sellFood() {
    const amount = parseInt(document.getElementById('sellFoodAmount').value) || 0;
    if (amount <= 0) {
        showPopup("–ù–µ–ª—å–∑—è –ø—Ä–æ–¥–∞—Ç—å 0 –∏–ª–∏ –º–µ–Ω—å—à–µ –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è!");
        return;
    }
    if (gameState.food < amount) {
        showPopup("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏!");
        return;
    }
    const revenue = amount;
    gameState.food -= amount;
    updateBalance(revenue);
    updateResources();
    updateSellFoodCost();
    saveGame();
}
    </script>
</body>
</html>
